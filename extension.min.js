let arrNodes=[];let url=document.URL.split("/");if(url.includes("kanban_deister")&&url.includes("kanban")&&url.includes("rest")){let btn=document.querySelector("#appBarScrollTarget button");let interval=setInterval(()=>{console.log("INTERVAL");btn=document.querySelector("#appBarScrollTarget button");if(btn){btn.addEventListener("click",setTimeSheetFormat);clearInterval(interval)}},1e3)}if(document.URL.indexOf("dbstudio")!=-1){window.addEventListener("beforeunload",event=>{event.preventDefault();event.returnValue=""});openPDF()}document.addEventListener("keydown",function(event){if(event.shiftKey&&event.keyCode===13){event.preventDefault();let icon=document.querySelector(".v-window-item--active>.dbstudio-flex-header-body .fa.fa-play");let barra=document.getElementsByClassName("x-panel-bbar")[1];let oldERP=[...document.querySelectorAll('[id*="btnInnerEl"]')].filter(el=>el.innerHTML=="Execute").find(el=>!el.closest(".x-panel.x-tabpanel-child.x-panel-default").style["display"]);let textarea=document.querySelector("textarea");2;if(icon){icon.closest("button").click()}else if(barra){[...barra.getElementsByTagName("button")].at(-1).click();let modal=document.querySelector(".x-window.x-resizable-pinned");if(modal){let tmp_interval=setInterval(()=>{if(modal.style.left.substring(0,modal.style.left.length-2)<0){textarea.focus();clearInterval(tmp_interval)}})}}else if(oldERP){oldERP.click();let tmp_interval=setInterval(()=>{if(!oldERP.closest("a").classList.contains("x-item-disabled")){textarea.focus();clearInterval(tmp_interval)}},1e3)}else{buscarPrimerNieto(document.querySelector(".v-window-item--active"),"v-window-item--active").querySelector(".fa.fa-play").click()}}let btnSave=document.activeElement.closest(".v-window-item--active")?.querySelector(".v-icon.mdi.mdi-content-save-outline")||document.querySelector(".v-icon.mdi.mdi-content-save-outline")||[...document.querySelectorAll(".v-icon.material-icons")].find(el=>el.innerHTML=="save");if(btnSave)btnSave.addEventListener("click",autoNotes);if(event.key=="s"&&event.metaKey)autoNotes();if(event.ctrlKey){switch(event.keyCode){case 87:prevResult(event);break;case 83:nextResult(event);break;case 85:nextTab(event);break;case 89:newTab();break;case 76:nextTab(event,true);break;case 72:clearCache();break;case 68:duplicateTab();break;case 79:openDBStudio();break;case 73:explorer();break}}});function openPDF(){let targetNode=[...document.querySelectorAll(".editor-resultset-container")].at(-1);const callback=function(mutationsList,observer){console.log(mutationsList);for(const mutation of mutationsList){if(mutation.type==="childList"){console.log("Nodos añadidos:",mutation.addedNodes);for(let node of mutation.addedNodes){if(node&&node.nodeName&&node.nodeName!="#comment"&&node.classList.contains("active-tab-rs")){node.querySelectorAll("table tbody tr").forEach(row=>{let icon=row.querySelector(".v-icon.notranslate.mdi.mdi-content-save");if(icon){icon.closest("a").removeAttribute("download");icon.closest("a").setAttribute("target","blank")}})}}}}};const observer=new MutationObserver(callback);const config={childList:true};let interval=setInterval(()=>{if(targetNode&&!arrNodes.includes(targetNode)){arrNodes.push(targetNode);observer.observe(targetNode,config);clearInterval(interval);console.log(arrNodes)}else{targetNode=[...document.querySelectorAll(".editor-resultset-container")].at(-1)}},1e3)}function autoNotes(){let nota=document.querySelector('[data-ax-id*="_notes"], [id*="rcs_notes"]');if(nota.value=="")nota.value="fix";let inputEvent=new Event("input",{bubbles:true,cancelable:true});nota.focus();nota.dispatchEvent(inputEvent);clearCache()}function clearCache(){let btnCache=document.querySelector(".mdi-memory")||[...document.querySelectorAll(".material-icons")].find(el=>el.innerHTML=="memory");btnCache.click()}function duplicateTab(){window.open(document.URL)}function openDBStudio(){let dbstudioURL="/os/dbstudio#/databases";let oldDbstudioURL="/webOS/dbstudio/";fetch(dbstudioURL).then(res=>{if(res.ok){window.open(dbstudioURL)}else{window.open(oldDbstudioURL)}})}function explorer(){fetch("/webOS/dbstudio/").then(res=>{if(res.ok){window.open("/webOS/explorer/")}})}function setTimeSheetFormat(){let txtArea=document.querySelector(".v-dialog--active textarea");txtArea.value="- Nombre: \n- Solicitante: \n- Descripción: \n- Estado actual: \n- Ubicación :";txtArea.focus();let inputEvent=new Event("input",{bubbles:true,cancelable:true});txtArea.dispatchEvent(inputEvent);txtArea.setSelectionRange(10,10)}function nextResult(event){event.preventDefault();let selectedRow=document.querySelector(".v-window-item--active .ax-grid-selected-row")||document.querySelector(".v-window-item--active .ax-grid-row__selected");let nextRow=selectedRow.nextElementSibling;if(nextRow){nextRow.firstElementChild.click()}else{selectedRow.parentNode.querySelector(".ax-grid-content-row").firstElementChild.click()}}function prevResult(event){event.preventDefault();let selectedRow=document.querySelector(".v-window-item--active .ax-grid-selected-row")||document.querySelector(".v-window-item--active .ax-grid-row__selected");let prevRow=selectedRow.previousElementSibling;if(prevRow&&!prevRow.classList.contains("ax-grid-row__control-width")){prevRow.firstElementChild.click()}else{[...selectedRow.parentNode.querySelectorAll(".ax-grid-content-row")].at(-1).firstElementChild.click()}}function buscarPrimerNieto(elemento,clase){let queue=[elemento];let ultimoNoNulo=null;while(queue.length>0){let elementoActual=queue.shift();let hijos=elementoActual.children;for(let i=0;i<hijos.length;i++){let hijo=hijos[i];if(hijo.classList.contains(clase)){queue=[...hijo.children];ultimoNoNulo=hijo;break}queue.push(hijo)}}return ultimoNoNulo}async function newTab(){let tab=document.querySelectorAll(".v-slide-group__content.v-tabs-bar__content")[1]||document.querySelectorAll(".v-slide-group__content.v-tabs-bar__content")[0];let active_tab=tab.querySelector(".v-tab.v-tab--active :first-child");let contextEvent=new Event("contextmenu",{bubbles:true,cancelable:true});await active_tab.dispatchEvent(contextEvent);document.querySelector(".v-list-item__title").click();document.querySelector(".menuable__content__active .v-list-item__title").closest('[role="menu"]').style.display="none";openPDF()}function nextTab(event,del){event.preventDefault();let tab=document.querySelectorAll(".v-slide-group__content.v-tabs-bar__content")[1]||document.querySelectorAll(".v-slide-group__content.v-tabs-bar__content")[0];tab=tab.querySelector(".v-tab.v-tab--active");if(del)return tab.lastElementChild.click();if(tab.nextElementSibling){tab.nextElementSibling.click()}else{tab.parentNode.querySelector(".v-tab").click()}}